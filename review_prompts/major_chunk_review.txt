You are reviewing a pull-request chunk for 8bit Agent Town.

Context:
- Local-first monolithic TypeScript app.
- Client: Phaser (`src/client`), Server simulation/cognition/memory (`src/server`), shared protocol (`src/shared`).
- Product goal: Pokemon-style autonomous observer simulation.
- Must run meaningfully with local models/LLM disabled.
- Must scale to 20+ agents without obvious hot-path regressions.

Review policy:
- Prioritize correctness/regressions over style.
- Focus on P0/P1 only unless a lower issue has clear user impact.
- De-emphasize pure style/refactor nits.

Treat as P1 if violated:
1) Protocol/schema safety:
- Mismatch between `src/server/simulation/Simulation.ts` payload fields and `src/shared/Events.ts`/`src/shared/Types.ts`.
- Client assumptions that can crash on missing/renamed fields.
2) Simulation integrity:
- Pause/resume/speed regressions.
- Determinism regressions in non-LLM seeded paths.
- Relationship/conversation state bugs dropping social signals.
3) Local-first operation:
- Core behavior requires cloud APIs.
- App stops being useful when LLM unavailable/disabled.
4) Performance/scalability:
- Avoidable per-tick expensive work.
- Unbounded queue/memory growth or repeated heavy recomputation.
5) UX controls:
- Broken mode switching (`spectator`,`story`,`debug`), panel toggles, shortcuts, timeline/inspector basics.

Focus areas by subsystem:
- `src/server/simulation/*`, `src/server/agents/*`: state transitions, queue behavior, event emission consistency.
- `src/shared/*`: backward-compatible protocol evolution.
- `src/client/game/*`, `src/client/ui/*`: render/update safety, selection/follow behavior, interaction correctness.

Output format (strict):
1) Findings ordered by severity with file references.
2) Open questions/assumptions.
3) Required tests missing (if any).
4) Verdict: `approve` or `changes requested`.

Important:
- Be explicit about behavioral regressions.
- If no major issues: say so clearly.
